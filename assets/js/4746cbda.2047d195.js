"use strict";(self.webpackChunkdocs_rancherdesktop_io=self.webpackChunkdocs_rancherdesktop_io||[]).push([[688],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,k=c["".concat(s,".").concat(m)]||c[m]||d[m]||i;return n?a.createElement(k,o(o({ref:t},u),{},{components:n})):a.createElement(k,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5162:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(7294),r=n(4334),i="tabItem_Ymn6";function o(e){let{children:t,hidden:n,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i,o),hidden:n},t)}},5488:function(e,t,n){n.d(t,{Z:function(){return m}});var a=n(3117),r=n(7294),i=n(4334),o=n(2389),l=n(7392),s=n(7094),p=n(2466),u="tabList__CuJ",d="tabItem_LNqP";function c(e){var t;const{lazy:n,block:o,defaultValue:c,values:m,groupId:k,className:h}=e,f=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=m??f.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),v=(0,l.l)(b,((e,t)=>e.value===t.value));if(v.length>0)throw new Error(`Docusaurus error: Duplicate values "${v.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const w=null===c?c:c??(null==(t=f.find((e=>e.props.default)))?void 0:t.props.value)??f[0].props.value;if(null!==w&&!b.some((e=>e.value===w)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${w}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:C}=(0,s.U)(),[N,g]=(0,r.useState)(w),O=[],{blockElementScrollPositionUntilNextRender:E}=(0,p.o5)();if(null!=k){const e=y[k];null!=e&&e!==N&&b.some((t=>t.value===e))&&g(e)}const T=e=>{const t=e.currentTarget,n=O.indexOf(t),a=b[n].value;a!==N&&(E(t),g(a),null!=k&&C(k,String(a)))},x=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=O.indexOf(e.currentTarget)+1;n=O[t]??O[0];break}case"ArrowLeft":{const t=O.indexOf(e.currentTarget)-1;n=O[t]??O[O.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:(0,i.Z)("tabs-container",u)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":o},h)},b.map((e=>{let{value:t,label:n,attributes:o}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,key:t,ref:e=>O.push(e),onKeyDown:x,onFocus:T,onClick:T},o,{className:(0,i.Z)("tabs__item",d,null==o?void 0:o.className,{"tabs__item--active":N===t})}),n??t)}))),n?(0,r.cloneElement)(f.filter((e=>e.props.value===N))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},f.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==N})))))}function m(e){const t=(0,o.Z)();return r.createElement(c,(0,a.Z)({key:String(t)},e))}},7241:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return d}});var a=n(3117),r=(n(7294),n(3905)),i=n(5488),o=n(5162);const l={title:"Running When Offline"},s=void 0,p={unversionedId:"how-to-guides/running-air-gapped",id:"how-to-guides/running-air-gapped",title:"Running When Offline",description:"Rancher Desktop can be run when offline, aka in air-gapped mode. This document covers requirements",source:"@site/docs/how-to-guides/running-air-gapped.md",sourceDirName:"how-to-guides",slug:"/how-to-guides/running-air-gapped",permalink:"/how-to-guides/running-air-gapped",draft:!1,editUrl:"https://github.com/rancher-sandbox/docs.rancherdesktop.io/edit/main/docs/how-to-guides/running-air-gapped.md",tags:[],version:"current",frontMatter:{title:"Running When Offline"},sidebar:"tutorialSidebar",previous:{title:"Provisioning Scripts",permalink:"/how-to-guides/provisioning-scripts"},next:{title:"Architecture",permalink:"/references/architecture"}},u={},d=[{value:"Network-Sensitive areas",id:"network-sensitive-areas",level:3},{value:"Existing Deployments",id:"existing-deployments",level:3},{value:"Preparing an Air-Gapped System",id:"preparing-an-air-gapped-system",level:3},{value:"The Cache Directory",id:"the-cache-directory",level:4},{value:"The kuberlr Directory",id:"the-kuberlr-directory",level:4},{value:"A Note on Versions",id:"a-note-on-versions",level:5}],c={toc:d};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Rancher Desktop can be run when offline, aka in air-gapped mode. This document covers requirements\nand possible problems when running in air-gapped mode."),(0,r.kt)("h3",{id:"network-sensitive-areas"},"Network-Sensitive areas"),(0,r.kt)("p",null,"There are two areas where Rancher Desktop assumes network availability and will recover in an air-gapped situation:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Pulling Kubernetes ",(0,r.kt)("inlineCode",{parentName:"p"},"k3s")," images into the ",(0,r.kt)("inlineCode",{parentName:"p"},"k3s")," cache directory")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Using ",(0,r.kt)("inlineCode",{parentName:"p"},"kuberlr")," as a version-aware wrapper around ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl"),", so the client never differs from the Kubernetes server by more than one minor version."))),(0,r.kt)("h3",{id:"existing-deployments"},"Existing Deployments"),(0,r.kt)("p",null,"If Rancher Desktop has been installed on a machine initially with networked access, it can\nbe run subsequently on that machine after network connectivity has been turned off. The main\ndifference in core functionality is that the list of versions of Kubernetes available in drop-down menus\nis limited to those versions that have actually been downloaded and stored in the cache."),(0,r.kt)("p",null,"There is a problem using the ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," client, because of the ",(0,r.kt)("inlineCode",{parentName:"p"},"kuberlr")," wrapper (Windows users should add the ",(0,r.kt)("inlineCode",{parentName:"p"},".exe")," suffix to each executable utility file)."),(0,r.kt)("p",null,"In this case, we're discussing a system that was initialized when connected to the internet, but we're about\nto take the machine offline for future use."),(0,r.kt)("p",null,"Suppose there are three versions of ",(0,r.kt)("inlineCode",{parentName:"p"},"k3s")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher-desktop")," cache."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"1.24.3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"1.21.14")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"1.19.16"))),(0,r.kt)("p",null,"But suppose that on this system we only ran ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," when using versions ",(0,r.kt)("inlineCode",{parentName:"p"},"1.24.3")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"1.21.14"),". This means that\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.kuberlr/PLATFORM-ARCH/")," directory (",(0,r.kt)("inlineCode",{parentName:"p"},"%HOME%/.kuberlr/windows-amd64")," on Windows) will contain only two files:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"kubectl1.24.3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"kubectl1.21.14"))),(0,r.kt)("p",null,"If we go offline and use the UI to switch to Kubernetes ",(0,r.kt)("inlineCode",{parentName:"p"},"1.19.16"),", when ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," is run, the system will fail.\nThe problem is that ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," is an alias for ",(0,r.kt)("inlineCode",{parentName:"p"},"kuberlr"),", which will try to download ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl 1.19.16")," and install it\nin the ",(0,r.kt)("inlineCode",{parentName:"p"},".kuberlr")," directory, but won't be able to access it."),(0,r.kt)("p",null,"So in this case, it would be best to prepare a connected system for disconnecting by selecting each available version of\nKubernetes currently in the cache, and running ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl --context rancher-desktop cluster-info")," to ensure that an appropriate\nversion of the ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," client is installed."),(0,r.kt)("p",null,"You ",(0,r.kt)("em",{parentName:"p"},"could")," install versioned ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl"),"s manually. This is covered in the next section."),(0,r.kt)("h3",{id:"preparing-an-air-gapped-system"},"Preparing an Air-Gapped System"),(0,r.kt)("p",null,"Here we assume you have some kind of removable media which you can populate on an internet-connected system, and then move over to the air-gapped system."),(0,r.kt)("p",null,"There are two directories that need to be populated in order for Rancher Desktop to function off-line:"),(0,r.kt)("h4",{id:"the-cache-directory"},"The Cache Directory"),(0,r.kt)("p",null,"To populate a source disk (which we refer to here as ",(0,r.kt)("inlineCode",{parentName:"p"},"%SOURCEDISK%"),", although it is probably some kind of removable medium like a USB thumb drive), you need the following files:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"k3s-versions.json")," -- this file is created by Rancher Desktop. It reads a raw JSON file from ",(0,r.kt)("inlineCode",{parentName:"li"},"https://update.k3s.io/v1-release/channels")," and converts it into a different kind of JSON file. Currently there is no utility to do that conversion; the easiest way to get this file is to run Rancher Desktop on a connected system and save the ",(0,r.kt)("inlineCode",{parentName:"li"},"CACHE/k3s-versions.json")," file (see below for where ",(0,r.kt)("inlineCode",{parentName:"li"},"CACHE")," exists on different platforms)."),(0,r.kt)("li",{parentName:"ul"},"Tar archives of Kubernetes K3s images. These are listed at ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/k3s-io/k3s/releases"},"https://github.com/k3s-io/k3s/releases"),", and you'll want to download ",(0,r.kt)("inlineCode",{parentName:"li"},"k3s-airgap-images-amd64.tar")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"k3s-airgap-images-arm64.tar")," (for AMD/intel and M1 machines respectively) for the versions you plan on working with. For example, the following commands will let you work with K3s v1.24.3 build 1 offline:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd .../CACHE\nmkdir v1.24.3+k3s1\ncd v1.24.3+k3s1\nwget https://github.com/k3s-io/k3s/releases/download/v1.24.3%2Bk3s1/k3s-airgap-images-amd64.tar\nwget https://github.com/k3s-io/k3s/releases/download/v1.24.3%2Bk3s1/sha256sum-amd64.txt\n")),(0,r.kt)(i.Z,{groupId:"os",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Windows",mdxType:"TabItem"},(0,r.kt)("p",null,"On Windows, the cache directory is at ",(0,r.kt)("inlineCode",{parentName:"p"},"%HOME%\\AppData\\Local\\rancher-desktop\\cache\\k3s"),", and can be created with the command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mkdir --Force %HOME%\\AppData\\Local\\rancher-desktop\\cache\\k3s\n")),(0,r.kt)("p",null,"Assuming you have some source media, you would also run the following commands to pre-populate the cache:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"copy-item %SOURCEDISK%\\k3s-versions.json %HOME%\\AppData\\Local\\rancher-desktop\\cache\\\ncopy-item -Recurse %SOURCEDISK%\\v<MAJOR>.<MINOR>.<PATCH>+k3s<BUILD> %HOME%\\AppData\\Local\\rancher-desktop\\cache\\k3s\\\n"))),(0,r.kt)(o.Z,{value:"macOS",mdxType:"TabItem"},(0,r.kt)("p",null,"On macOS, the cache directory is at ",(0,r.kt)("inlineCode",{parentName:"p"},"$HOME/Library/Caches/rancher-desktop")," and the commands to populate it would be"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"CACHEDIR=$HOME/Library/Caches/rancher-desktop\nmkdir -p $CACHEDIR/k3s\ncp $SOURCEDISK/k3s-versions.json $CACHEDIR/\ncp -r $SOURCEDISK/v<MAJOR>.<MINOR>.<PATCH>+k3s<BUILD> $CACHEDIR/k3s/\n"))),(0,r.kt)(o.Z,{value:"Linux",mdxType:"TabItem"},(0,r.kt)("p",null,"On Linux, the cache directory is at ",(0,r.kt)("inlineCode",{parentName:"p"},"$HOME/.cache/rancher-desktop")," and the commands to populate it would be"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"CACHEDIR=$HOME/.cache/rancher-desktop\nmkdir -p $CACHEDIR/k3s\ncp $SOURCEDISK/k3s-versions.json $CACHEDIR/\ncp -r $SOURCEDISK/v<MAJOR>.<MINOR>.<PATCH>+k3s<BUILD> $CACHEDIR/k3s/\n")))),(0,r.kt)("h4",{id:"the-kuberlr-directory"},"The kuberlr Directory"),(0,r.kt)("p",null,"The location of this directory is more straightforward. On all platforms, it's at ",(0,r.kt)("inlineCode",{parentName:"p"},"HOME/.kuberlr/PLATFORM-ARCH")," where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"HOME")," is the home directory: usually ",(0,r.kt)("inlineCode",{parentName:"li"},"%HOMEDRIVE%\\%HOMEPATH")," on Windows, and ",(0,r.kt)("inlineCode",{parentName:"li"},"~")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"$HOME")," on macOS and Linux."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"PLATFORM")," is one of ",(0,r.kt)("inlineCode",{parentName:"li"},"windows"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"linux"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"darwin"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ARCH")," is ",(0,r.kt)("inlineCode",{parentName:"li"},"aarch64")," on M1 machines, and ",(0,r.kt)("inlineCode",{parentName:"li"},"amd64")," everywhere else.")),(0,r.kt)("p",null,"To populate it, determine which versions of Kubernetes you'll be using, and download the appropriate executables from the internet. These would be in:"),(0,r.kt)(i.Z,{groupId:"os",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Windows",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"https://dl.k8s.io/VERSION/bin/PLATFORM/CPU/kubectl.exe"))),(0,r.kt)(o.Z,{value:"macOS & Linux",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"https://dl.k8s.io/VERSION/bin/PLATFORM/CPU/kubectl")))),(0,r.kt)("p",null,"Where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"VERSION")," will have the form ",(0,r.kt)("inlineCode",{parentName:"li"},"vMAJOR.MINOR.PATCH")," (like ",(0,r.kt)("inlineCode",{parentName:"li"},"v1.22.1"),"),"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"PLATFORM")," will be one of ",(0,r.kt)("inlineCode",{parentName:"li"},"darwin"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"linux"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"windows"),","),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CPU")," will ",(0,r.kt)("inlineCode",{parentName:"li"},"arm64")," on M1 machines and ",(0,r.kt)("inlineCode",{parentName:"li"},"amd64")," everywhere else.")),(0,r.kt)("p",null,"For example, to get a kubectl for Windows that will work with Kubernetes v1.22, this Windows command-shell (not PowerShell) command will put it on the ",(0,r.kt)("inlineCode",{parentName:"p"},"SOURCEDISK"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"wget -O %SOURCEDISK/kubectl1.22.1.exe https://dl.k8s.io/v1.22.1/bin/windows/amd64/kubectl.exe\n")),(0,r.kt)("h5",{id:"a-note-on-versions"},"A Note on Versions"),(0,r.kt)("p",null,"Kubectl clients are guaranteed to work with servers that are running the same MAJOR version and differ in the MINOR version by at most 1. So for example, if your organization is working with Kubernetes versions v1.21.x, v1.22.x, and v1.23.x, for any patch-version of ",(0,r.kt)("inlineCode",{parentName:"p"},"x"),", you would only need to install ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl1.22.x")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},".kuberlr")," directory. But if you copy a ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.24.x")," of Kubernetes into the ",(0,r.kt)("inlineCode",{parentName:"p"},"CACHE")," directory, you'll need to ensure there's a compatible ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},".kuberlr")," directory as well (any of ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.23.x"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.24.x"),", or ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.25.x")," would suffice)."))}m.isMDXComponent=!0}}]);